{"filter":false,"title":"lambda_function.py","tooltip":"/cdk-app/lambda/ssb/check-D/lambda_function.py","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":53,"column":30},"action":"remove","lines":["import boto3","import ssb","import datetime","import json","import os","","def lambda_handler(event, context):","    session = boto3.Session()","    sns = session.client(\"sns\")","    bucket = os.environ['Bucket'][13:]","    topic = os.environ[\"Topic\"]","    ","    try:","        iam = session.client('iam')","        iam.generate_credential_report()","    except:","        pass","","    try:","        results = ssb.check10(session)","        print(results)","        #results.sort(key=lambda x: x[\"title\"])","        ","        name = f\"result-D-{datetime.date.today().isoformat()}.json\"","","        if upload_file(bucket, name, json.dumps(results)):","            sns.publish(TopicArn=topic, Message=\"리포트 D가 생성되었습니다.\")","            return {","            'statusCode': 200,","            \"body\": json.dumps(\"upload success\"),","            }","        else:","            sns.publish(TopicArn=topic, Message=\"리포트 D 생성 중 오류가 발생하였습니다.\")","            return {","            'statusCode': 400,","            'body': json.dumps(\"upload fail\")","            }","    except:","        sns.publish(TopicArn=topic, Message=\"리포트 D 생성 중 오류가 발생하였습니다.\")","","","","    ","def upload_file(bucket, name, file):","    encoded = bytes(file.encode('UTF-8'))","    s3 = boto3.client('s3')","    try:","        s3.put_object(Bucket=bucket, Key=name, Body=encoded)","        return True","    except:","        return False","","if __name__ == \"__main__\":","    lambda_handler(None, None)"],"id":2},{"start":{"row":0,"column":0},"end":{"row":47,"column":30},"action":"insert","lines":["import boto3","import ssb","import datetime","import json","import os","","def lambda_handler(event, context):","    session = boto3.Session()","    sns = session.client(\"sns\")","    bucket = os.environ['Bucket'][13:]","    topic = os.environ[\"Topic\"]","    ","","    try:","        results = ssb.checks(session)","        print(results)","        ","        name = f\"result-D-{datetime.date.today().isoformat()}.json\"","","        if upload_file(bucket, name, json.dumps(results)):","            sns.publish(TopicArn=topic, Message=\"리포트 D가 생성되었습니다.\")","            return {","            'statusCode': 200,","            \"body\": json.dumps(\"upload success\"),","            }","        else:","            sns.publish(TopicArn=topic, Message=\"리포트 D 생성 중 오류가 발생하였습니다.\")","            return {","            'statusCode': 400,","            'body': json.dumps(\"upload fail\")","            }","    except:","        sns.publish(TopicArn=topic, Message=\"리포트 D 생성 중 오류가 발생하였습니다.\")","","","","    ","def upload_file(bucket, name, file):","    encoded = bytes(file.encode('UTF-8'))","    s3 = boto3.client('s3')","    try:","        s3.put_object(Bucket=bucket, Key=name, Body=encoded)","        return True","    except:","        return False","","if __name__ == \"__main__\":","    lambda_handler(None, None)"]}]]},"ace":{"folds":[],"scrolltop":434,"scrollleft":0,"selection":{"start":{"row":47,"column":30},"end":{"row":47,"column":30},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1658388721900,"hash":"e42e7302f71a33d3d4cbb8e57445555f49db85a6"}