{"filter":false,"title":"lambda_function.py","tooltip":"/cdk-app/lambda/ssb/check-C/lambda_function.py","undoManager":{"mark":1,"position":1,"stack":[[{"start":{"row":12,"column":8},"end":{"row":12,"column":9},"action":"insert","lines":["a"],"id":2}],[{"start":{"row":0,"column":0},"end":{"row":53,"column":30},"action":"remove","lines":["import boto3","import ssb","import datetime","import json","import os","","def lambda_handler(event, context):","    session = boto3.Session()","    sns = session.client(\"sns\")","    bucket = os.environ['Bucket'][13:]","    topic = os.environ[\"Topic\"]","    ","    try:a","        iam = session.client('iam')","        iam.generate_credential_report()","    except:","        pass","","    try:","        results = ssb.check08(session)","        print(results)","        #results.sort(key=lambda x: x[\"title\"])","        ","        name = f\"result-C-{datetime.date.today().isoformat()}.json\"","","        if upload_file(bucket, name, json.dumps(results)):","            sns.publish(TopicArn=topic, Message=\"리포트 C가 생성되었습니다.\")","            return {","            'statusCode': 200,","            \"body\": json.dumps(\"upload success\"),","            }","        else:","            sns.publish(TopicArn=topic, Message=\"리포트 C 생성 중 오류가 발생하였습니다.\")","            return {","            'statusCode': 400,","            'body': json.dumps(\"upload fail\")","            }","    except:","        sns.publish(TopicArn=topic, Message=\"리포트 C 생성 중 오류가 발생하였습니다.\")","","","","    ","def upload_file(bucket, name, file):","    encoded = bytes(file.encode('UTF-8'))","    s3 = boto3.client('s3')","    try:","        s3.put_object(Bucket=bucket, Key=name, Body=encoded)","        return True","    except:","        return False","","if __name__ == \"__main__\":","    lambda_handler(None, None)"],"id":3},{"start":{"row":0,"column":0},"end":{"row":47,"column":30},"action":"insert","lines":["import boto3","import ssb","import datetime","import json","import os","","def lambda_handler(event, context):","    session = boto3.Session()","    sns = session.client(\"sns\")","    bucket = os.environ['Bucket'][13:]","    topic = os.environ[\"Topic\"]","    ","    try:","        results = ssb.checks(session)","        print(results)","        #results.sort(key=lambda x: x[\"title\"])","        ","        name = f\"result-C-{datetime.date.today().isoformat()}.json\"","","        if upload_file(bucket, name, json.dumps(results)):","            sns.publish(TopicArn=topic, Message=\"리포트 C가 생성되었습니다.\")","            return {","            'statusCode': 200,","            \"body\": json.dumps(\"upload success\"),","            }","        else:","            sns.publish(TopicArn=topic, Message=\"리포트 C 생성 중 오류가 발생하였습니다.\")","            return {","            'statusCode': 400,","            'body': json.dumps(\"upload fail\")","            }","    except:","        sns.publish(TopicArn=topic, Message=\"리포트 C 생성 중 오류가 발생하였습니다.\")","","","","    ","def upload_file(bucket, name, file):","    encoded = bytes(file.encode('UTF-8'))","    s3 = boto3.client('s3')","    try:","        s3.put_object(Bucket=bucket, Key=name, Body=encoded)","        return True","    except:","        return False","","if __name__ == \"__main__\":","    lambda_handler(None, None)"]}]]},"ace":{"folds":[],"scrolltop":433.3333435058594,"scrollleft":0,"selection":{"start":{"row":41,"column":13},"end":{"row":41,"column":14},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":27,"state":"start","mode":"ace/mode/python"}},"timestamp":1658388718223,"hash":"f6c0dfac8bb5cff8c3f837f30112443d4dd57d60"}